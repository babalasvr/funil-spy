<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script
      src="https://cdn.utmify.com.br/scripts/utms/latest.js"
      data-utmify-prevent-xcod-sck
      data-utmify-prevent-subids
      async
      defer
    ></script>
    <title>🎯 Funil Spy - Sistema de Remarketing Completo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .demo-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background: #4ade80; }
        .status-inactive { background: #ef4444; }
        .status-pending { background: #f59e0b; }

        .btn {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .metric {
            text-align: center;
            margin: 10px 0;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #4ade80;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4ade80, #22c55e);
            height: 100%;
            transition: width 0.5s ease;
        }

        .user-form {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .alert-success {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid #4ade80;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Sistema de Remarketing Funil Spy</h1>
            <p>Demonstração completa do sistema de remarketing com tracking avançado</p>
        </div>

        <!-- Status Dashboard -->
        <div class="demo-section">
            <h2>📊 Dashboard de Status</h2>
            <div class="demo-grid">
                <div class="demo-card">
                    <h3><span class="status-indicator status-active"></span>Analytics Core</h3>
                    <div class="metric">
                        <div class="metric-value" id="sessionCount">0</div>
                        <div class="metric-label">Sessões Ativas</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="eventCount">0</div>
                        <div class="metric-label">Eventos Tracked</div>
                    </div>
                </div>

                <div class="demo-card">
                    <h3><span class="status-indicator status-active"></span>Pixel Tracking</h3>
                    <div class="metric">
                        <div class="metric-value" id="behaviorScore">0</div>
                        <div class="metric-label">Behavior Score</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="scoreProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="demo-card">
                    <h3><span class="status-indicator status-pending"></span>Remarketing</h3>
                    <div class="metric">
                        <div class="metric-value" id="audienceSize">0</div>
                        <div class="metric-label">Usuários na Audiência</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="campaignsSent">0</div>
                        <div class="metric-label">Campanhas Enviadas</div>
                    </div>
                </div>

                <div class="demo-card">
                    <h3><span class="status-indicator status-active"></span>Third-Party Pixels</h3>
                    <p><span class="status-indicator status-active"></span>Facebook Pixel</p>
                    <p><span class="status-indicator status-active"></span>Google Ads</p>
                    <p><span class="status-indicator status-active"></span>Google Analytics</p>
                </div>
            </div>
        </div>

        <!-- User Simulation -->
        <div class="demo-section">
            <h2>👤 Simulação de Usuário</h2>
            <p>Simule diferentes comportamentos de usuário para testar o sistema de remarketing:</p>
            
            <div class="user-form">
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="userName" placeholder="Digite seu nome">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="userEmail" placeholder="Digite seu email">
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="tel" id="userPhone" placeholder="Digite seu telefone">
                </div>
            </div>

            <div class="demo-grid">
                <div class="demo-card">
                    <h3>🎭 Comportamentos Simulados</h3>
                    <button class="btn" onclick="simulatePageView()">Visualizar Relatório</button>
                    <button class="btn btn-secondary" onclick="simulateFormStart()">Iniciar Formulário</button>
                    <button class="btn btn-warning" onclick="simulateCheckout()">Ir para Checkout</button>
                    <button class="btn btn-danger" onclick="simulateExitIntent()">Exit Intent</button>
                </div>

                <div class="demo-card">
                    <h3>📧 Campanhas de Remarketing</h3>
                    <button class="btn" onclick="sendEmailCampaign()">Enviar Email</button>
                    <button class="btn btn-secondary" onclick="sendWhatsAppCampaign()">Enviar WhatsApp</button>
                    <button class="btn btn-warning" onclick="trackConversion()">Simular Conversão</button>
                </div>
            </div>

            <div id="userLog" class="log-area">
                <div>🚀 Sistema de remarketing iniciado...</div>
                <div>📊 Aguardando atividade do usuário...</div>
            </div>
        </div>

        <!-- Third-Party Integration -->
        <div class="demo-section">
            <h2>🔗 Integrações de Terceiros</h2>
            <div class="demo-grid">
                <div class="demo-card">
                    <h3>📘 Facebook</h3>
                    <p>Pixel ID: fb_demo_pixel</p>
                    <button class="btn" onclick="testFacebookPixel()">Testar Pixel Facebook</button>
                    <div class="alert alert-info">
                        <strong>Status:</strong> Eventos sendo enviados para Facebook
                    </div>
                </div>

                <div class="demo-card">
                    <h3>🎯 Google Ads</h3>
                    <p>Conversion ID: AW-demo-id</p>
                    <button class="btn btn-secondary" onclick="testGoogleAds()">Testar Google Ads</button>
                    <div class="alert alert-success">
                        <strong>Status:</strong> Conversões sendo tracked
                    </div>
                </div>

                <div class="demo-card">
                    <h3>📱 WhatsApp Business</h3>
                    <p>Status: Simulação ativa</p>
                    <button class="btn btn-warning" onclick="testWhatsAppIntegration()">Testar WhatsApp</button>
                    <div class="alert alert-warning">
                        <strong>Status:</strong> Modo de demonstração
                    </div>
                </div>

                <div class="demo-card">
                    <h3>📈 Analytics</h3>
                    <p>GA4 ID: G-demo-id</p>
                    <button class="btn" onclick="viewAnalytics()">Ver Analytics</button>
                    <div class="alert alert-success">
                        <strong>Status:</strong> Coletando dados em tempo real
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Social Proof -->
        <div class="demo-section">
            <h2>👥 Prova Social em Tempo Real</h2>
            <div class="demo-grid">
                <div class="demo-card">
                    <h3>🔥 Atividade Recente</h3>
                    <div id="socialProofList">
                        <p>🟢 Maria descobriu 3 conversas suspeitas (há 2 min)</p>
                        <p>🟢 João confirmou suas suspeitas (há 5 min)</p>
                        <p>🟢 Ana encontrou evidências (há 8 min)</p>
                    </div>
                    <button class="btn" onclick="addSocialProof()">Adicionar Atividade</button>
                </div>

                <div class="demo-card">
                    <h3>📍 Mapa de Verificações</h3>
                    <div>
                        <p>🟢 São Paulo: <span id="spCount">234</span></p>
                        <p>🟢 Rio de Janeiro: <span id="rjCount">187</span></p>
                        <p>🟢 Belo Horizonte: <span id="bhCount">123</span></p>
                        <p>🟢 Brasília: <span id="bsbCount">98</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include our tracking scripts -->
    <script src="/analytics/public/tracking.js"></script>
    <script src="/analytics/public/pixel-tracking.js"></script>

    <!-- Demo functionality -->
    <script>
        // Demo state
        let demoState = {
            behaviorScore: 0,
            eventCount: 0,
            sessionCount: 1,
            audienceSize: 0,
            campaignsSent: 0,
            isIdentified: false,
            userId: null
        };

        // Initialize demo
        function initDemo() {
            updateDashboard();
            startRealTimeUpdates();
            logAction('Demo iniciado', 'Sistema de remarketing carregado com sucesso');
        }

        // Update dashboard metrics
        function updateDashboard() {
            document.getElementById('sessionCount').textContent = demoState.sessionCount;
            document.getElementById('eventCount').textContent = demoState.eventCount;
            document.getElementById('behaviorScore').textContent = demoState.behaviorScore;
            document.getElementById('audienceSize').textContent = demoState.audienceSize;
            document.getElementById('campaignsSent').textContent = demoState.campaignsSent;
            
            // Update progress bar
            const progressPercent = Math.min(demoState.behaviorScore, 100);
            document.getElementById('scoreProgress').style.width = progressPercent + '%';
        }

        // Behavior simulations
        function simulatePageView() {
            demoState.behaviorScore += 10;
            demoState.eventCount += 1;
            logAction('Page View', 'Usuário visualizou página de relatório (+10 pontos)');
            
            // Track with actual analytics
            if (window.FunnelAnalytics) {
                window.FunnelAnalytics.track('page_view_report', { source: 'demo' });
            }
            
            // Track with pixels
            if (window.trackAllPlatforms) {
                window.trackAllPlatforms('report_view', { value: 'demo_report' });
            }
            
            updateDashboard();
        }

        function simulateFormStart() {
            demoState.behaviorScore += 20;
            demoState.eventCount += 1;
            
            const userData = collectUserData();
            if (userData.email || userData.name) {
                identifyUser(userData);
            }
            
            logAction('Form Started', 'Usuário começou a preencher formulário (+20 pontos)');
            
            if (window.FunnelAnalytics) {
                window.FunnelAnalytics.track('form_started', userData);
            }
            
            updateDashboard();
        }

        function simulateCheckout() {
            demoState.behaviorScore += 30;
            demoState.eventCount += 1;
            logAction('Checkout View', 'Usuário acessou página de checkout (+30 pontos)');
            
            if (window.FunnelAnalytics) {
                window.FunnelAnalytics.track('page_view_checkout', { intent: 'high' });
            }
            
            updateDashboard();
        }

        function simulateExitIntent() {
            demoState.behaviorScore += 25;
            demoState.eventCount += 1;
            logAction('Exit Intent', 'Exit intent detectado - usuário de alto valor (+25 pontos)');
            
            // Show exit intent popup (from prototype)
            if (document.getElementById('exitPopup')) {
                document.getElementById('exitPopup').style.display = 'flex';
            }
            
            updateDashboard();
        }

        // User identification
        function collectUserData() {
            return {
                name: document.getElementById('userName').value,
                email: document.getElementById('userEmail').value,
                phone: document.getElementById('userPhone').value
            };
        }

        function identifyUser(userData) {
            if (demoState.isIdentified) return;
            
            demoState.isIdentified = true;
            demoState.audienceSize += 1;
            demoState.userId = 'demo_user_' + Date.now();
            
            logAction('User Identified', `Usuário identificado: ${userData.name || userData.email}`);
            
            // Add to remarketing audience
            if (window.FunnelPixel) {
                window.FunnelPixel.identifyUser(userData);
            }
            
            updateDashboard();
        }

        // Remarketing campaigns
        async function sendEmailCampaign() {
            if (!demoState.isIdentified) {
                alert('Identifique o usuário primeiro preenchendo o formulário!');
                return;
            }
            
            demoState.campaignsSent += 1;
            logAction('Email Campaign', 'Campanha de email enviada com 20% de desconto');
            
            // Simulate API call
            try {
                const response = await fetch('/api/remarketing/campaign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: demoState.userId,
                        campaignType: 'email'
                    })
                });
                
                if (response.ok) {
                    logAction('Email Sent', 'Email de remarketing enviado com sucesso!');
                }
            } catch (error) {
                logAction('Email Error', 'Erro simulado - email seria enviado em produção');
            }
            
            updateDashboard();
        }

        async function sendWhatsAppCampaign() {
            if (!demoState.isIdentified) {
                alert('Identifique o usuário primeiro preenchendo o formulário!');
                return;
            }
            
            demoState.campaignsSent += 1;
            logAction('WhatsApp Campaign', 'Campanha WhatsApp enviada com 40% de desconto');
            
            try {
                const response = await fetch('/api/remarketing/campaign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: demoState.userId,
                        campaignType: 'whatsapp'
                    })
                });
                
                if (response.ok) {
                    logAction('WhatsApp Sent', 'Mensagem WhatsApp enviada com sucesso!');
                }
            } catch (error) {
                logAction('WhatsApp Error', 'Simulação - mensagem seria enviada via WhatsApp API');
            }
            
            updateDashboard();
        }

        function trackConversion() {
            demoState.behaviorScore += 50;
            demoState.eventCount += 1;
            logAction('Conversion', 'Conversão realizada - R$ 27,90 (+50 pontos)');
            
            // Track conversion on all platforms
            if (window.trackAllPlatforms) {
                window.trackAllPlatforms('conversion', { 
                    value: 27.90, 
                    currency: 'BRL',
                    order_id: 'demo_' + Date.now()
                });
            }
            
            updateDashboard();
        }

        // Third-party testing
        function testFacebookPixel() {
            logAction('Facebook Test', 'Evento customizado enviado para Facebook Pixel');
            
            if (window.fbqTrack) {
                window.fbqTrack('Lead', { content_name: 'Demo Test' });
            }
        }

        function testGoogleAds() {
            logAction('Google Test', 'Evento de conversão enviado para Google Ads');
            
            if (window.gtagConversion) {
                window.gtagConversion(27.90);
            }
        }

        function testWhatsAppIntegration() {
            logAction('WhatsApp Test', 'Integração WhatsApp testada - modo simulação');
        }

        function viewAnalytics() {
            window.open('/admin', '_blank');
        }

        // Social proof
        function addSocialProof() {
            const names = ['Carlos', 'Maria', 'João', 'Ana', 'Pedro', 'Lucia'];
            const actions = ['descobriu conversas suspeitas', 'confirmou suas suspeitas', 'encontrou evidências'];
            const name = names[Math.floor(Math.random() * names.length)];
            const action = actions[Math.floor(Math.random() * actions.length)];
            const time = Math.floor(Math.random() * 10) + 1;
            
            const proofList = document.getElementById('socialProofList');
            const newProof = document.createElement('p');
            newProof.innerHTML = `🟢 ${name} ${action} (há ${time} min)`;
            proofList.insertBefore(newProof, proofList.firstChild);
            
            // Remove old entries
            if (proofList.children.length > 5) {
                proofList.removeChild(proofList.lastChild);
            }
        }

        // Real-time updates
        function startRealTimeUpdates() {
            // Update social proof every 10 seconds
            setInterval(() => {
                addSocialProof();
                
                // Update city counts
                document.getElementById('spCount').textContent = parseInt(document.getElementById('spCount').textContent) + Math.floor(Math.random() * 3);
                document.getElementById('rjCount').textContent = parseInt(document.getElementById('rjCount').textContent) + Math.floor(Math.random() * 2);
                document.getElementById('bhCount').textContent = parseInt(document.getElementById('bhCount').textContent) + Math.floor(Math.random() * 2);
                document.getElementById('bsbCount').textContent = parseInt(document.getElementById('bsbCount').textContent) + Math.floor(Math.random() * 1);
            }, 10000);
            
            // Update session count
            setInterval(() => {
                demoState.sessionCount = 800 + Math.floor(Math.random() * 200);
                updateDashboard();
            }, 5000);
        }

        // Logging
        function logAction(action, description) {
            const logArea = document.getElementById('userLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] <strong>${action}:</strong> ${description}`;
            logArea.insertBefore(logEntry, logArea.firstChild);
            
            // Keep only last 10 entries
            if (logArea.children.length > 10) {
                logArea.removeChild(logArea.lastChild);
            }
            
            console.log(`🎯 Demo Action: ${action} - ${description}`);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initDemo);
    </script>

    <!-- Facebook Pixel Code (Demo) -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');

        fbq('init', 'DEMO_FACEBOOK_PIXEL_ID');
        fbq('track', 'PageView');
    </script>

    <!-- Google Analytics (Demo) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DEMO-ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DEMO-ID');
    </script>

    <script>
      window.pixelId = "66ac66dd43136b1d66bddb65";
      var a = document.createElement("script");
      a.setAttribute("async", "");
      a.setAttribute("defer", "");
      a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
      document.head.appendChild(a);
    </script>

</body>
</html>