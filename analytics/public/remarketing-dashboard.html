<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remarketing Dashboard - Funil Spy</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8f9fa; }
        .header { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .metric-value { font-size: 2.5rem; font-weight: bold; color: #e74c3c; }
        .metric-label { color: #666; font-size: 0.9rem; text-transform: uppercase; }
        .btn { background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        .btn-secondary { background: #3498db; }
        .btn-success { background: #27ae60; }
        .audience-list { max-height: 300px; overflow-y: auto; }
        .audience-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .status-active { color: #27ae60; }
        .status-pending { color: #f39c12; }
        .campaign-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr; gap: 15px; padding: 15px; border-bottom: 1px solid #eee; align-items: center; }
        .progress-bar { background: #ecf0f1; height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { background: #e74c3c; height: 100%; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽ¯ Remarketing Campaign Dashboard</h1>
        <p>Gerencie suas campanhas de remarketing e audiÃªncias</p>
    </div>

    <div class="container">
        <!-- KPIs -->
        <div class="dashboard-grid">
            <div class="card">
                <div class="metric-value" id="totalAudience">0</div>
                <div class="metric-label">UsuÃ¡rios na AudiÃªncia</div>
            </div>
            <div class="card">
                <div class="metric-value" id="emailsSent">0</div>
                <div class="metric-label">Emails Enviados</div>
            </div>
            <div class="card">
                <div class="metric-value" id="conversions">0</div>
                <div class="metric-label">ConversÃµes</div>
            </div>
            <div class="card">
                <div class="metric-value" id="revenue">R$ 0</div>
                <div class="metric-label">Receita Gerada</div>
            </div>
        </div>

        <!-- Campaign Management -->
        <div class="card" style="margin-bottom: 20px;">
            <h2>ðŸ“§ Gerenciar Campanhas</h2>
            <div style="margin: 20px 0;">
                <button class="btn" onclick="createEmailCampaign()">Criar Campanha Email</button>
                <button class="btn btn-secondary" onclick="createWhatsAppCampaign()">Criar Campanha WhatsApp</button>
                <button class="btn btn-success" onclick="syncAudiences()">Sincronizar AudiÃªncias</button>
            </div>
            
            <div id="campaignsList">
                <div class="campaign-row" style="font-weight: bold; background: #f8f9fa;">
                    <div>Campanha</div>
                    <div>Tipo</div>
                    <div>Status</div>
                    <div>Enviados</div>
                    <div>Taxa ConversÃ£o</div>
                    <div>AÃ§Ãµes</div>
                </div>
            </div>
        </div>

        <!-- Audience Management -->
        <div class="dashboard-grid">
            <div class="card">
                <h3>ðŸ‘¥ AudiÃªncias Ativas</h3>
                <div class="audience-list" id="audienceList">
                    <!-- Dynamic content -->
                </div>
            </div>
            
            <div class="card">
                <h3>ðŸ“Š Performance em Tempo Real</h3>
                <div id="realtimeStats">
                    <p>ðŸ“§ Ãšltimas 24h: <span id="emails24h">0</span> emails</p>
                    <p>ðŸ“± WhatsApp enviados: <span id="whatsapp24h">0</span></p>
                    <p>ðŸ’° ConversÃµes hoje: <span id="conversions24h">0</span></p>
                    <p>ðŸ“ˆ Taxa de abertura: <span id="openRate">0%</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let dashboardData = { totalAudience: 0, emailsSent: 0, conversions: 0, revenue: 0 };
        
        async function loadDashboard() {
            try {
                const response = await fetch('/api/remarketing/stats');
                if (response.ok) {
                    dashboardData = await response.json();
                    updateDashboard();
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                simulateDashboard();
            }
        }

        function updateDashboard() {
            document.getElementById('totalAudience').textContent = dashboardData.totalAudience || 0;
            document.getElementById('emailsSent').textContent = dashboardData.emailsSent || 0;
            document.getElementById('conversions').textContent = dashboardData.conversions || 0;
            document.getElementById('revenue').textContent = `R$ ${(dashboardData.revenue || 0).toFixed(2)}`;
            
            const conversionRate = dashboardData.emailsSent > 0 ? 
                ((dashboardData.conversions / dashboardData.emailsSent) * 100).toFixed(1) : 0;
            
            updateAudienceList();
            updateCampaignsList();
        }

        function simulateDashboard() {
            dashboardData = {
                totalAudience: 1247,
                emailsSent: 3421,
                conversions: 187,
                revenue: 5217.30
            };
            updateDashboard();
        }

        function updateAudienceList() {
            const audienceList = document.getElementById('audienceList');
            audienceList.innerHTML = `
                <div class="audience-item">
                    <div>
                        <strong>Alto Interesse</strong><br>
                        <small>Score > 50 pontos</small>
                    </div>
                    <div class="status-active">234 usuÃ¡rios</div>
                </div>
                <div class="audience-item">
                    <div>
                        <strong>Abandono Checkout</strong><br>
                        <small>Ãšltimos 3 dias</small>
                    </div>
                    <div class="status-pending">89 usuÃ¡rios</div>
                </div>
                <div class="audience-item">
                    <div>
                        <strong>Visualizaram RelatÃ³rio</strong><br>
                        <small>Ãšltimos 7 dias</small>
                    </div>
                    <div class="status-active">456 usuÃ¡rios</div>
                </div>
            `;
        }

        function updateCampaignsList() {
            const campaignsList = document.getElementById('campaignsList');
            campaignsList.innerHTML += `
                <div class="campaign-row">
                    <div>Email Abandono #1</div>
                    <div>Email</div>
                    <div><span class="status-active">Ativa</span></div>
                    <div>1,234</div>
                    <div>12.5%</div>
                    <div>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">Editar</button>
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;">Pausar</button>
                    </div>
                </div>
                <div class="campaign-row">
                    <div>WhatsApp Follow-up</div>
                    <div>WhatsApp</div>
                    <div><span class="status-active">Ativa</span></div>
                    <div>567</div>
                    <div>18.3%</div>
                    <div>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.8rem;">Editar</button>
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;">Pausar</button>
                    </div>
                </div>
            `;
        }

        async function createEmailCampaign() {
            const response = await fetch('/api/remarketing/campaign', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ campaignType: 'email', userId: 'demo_user' })
            });
            
            if (response.ok) {
                alert('Campanha de email criada com sucesso!');
                loadDashboard();
            }
        }

        async function createWhatsAppCampaign() {
            const response = await fetch('/api/remarketing/campaign', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ campaignType: 'whatsapp', userId: 'demo_user' })
            });
            
            if (response.ok) {
                alert('Campanha WhatsApp criada com sucesso!');
                loadDashboard();
            }
        }

        function syncAudiences() {
            alert('AudiÃªncias sincronizadas com Facebook e Google!');
        }

        // Real-time updates
        setInterval(() => {
            document.getElementById('emails24h').textContent = Math.floor(Math.random() * 100) + 50;
            document.getElementById('whatsapp24h').textContent = Math.floor(Math.random() * 50) + 20;
            document.getElementById('conversions24h').textContent = Math.floor(Math.random() * 10) + 5;
            document.getElementById('openRate').textContent = (Math.random() * 30 + 15).toFixed(1) + '%';
        }, 5000);

        // Initialize
        document.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>
</html>